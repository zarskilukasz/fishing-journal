---
/**
 * User profile page.
 * Users can view and manage their profile settings.
 */
import AppLayout from "@/layouts/AppLayout.astro";
import { ProfileView } from "@/components/profile";

export const prerender = false;

// Get Supabase client from middleware (auth already verified in AppLayout)
const supabase = Astro.locals.supabase;
const {
  data: { user },
  error,
} = await supabase.auth.getUser();

// Redirect if not authenticated (should not happen due to AppLayout check)
if (error || !user) {
  return Astro.redirect("/auth/login?redirect=/app/profile");
}

// Prepare user session data for React component
const sessionUser = {
  id: user.id,
  email: user.email ?? "",
};
---

<AppLayout title="Profil">
  <ProfileView client:load user={sessionUser} />
</AppLayout>
